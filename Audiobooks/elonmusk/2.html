<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.min.js"></script>
    <title>Document</title>
</head>
<body>
    <style>@import url("https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap");
        @import url("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css");
        @import url("https://fonts.googleapis.com/icon?family=Material+Icons");
        
        * {
          box-sizing: border-box;
        }
        
        *:after,
        *:before {
          box-sizing: border-box;
        }
        
        :root {
          --bg-hue: 53;
      
          --text-color: #000000;
          --hover-bg: rgba(255, 187, 0, 0.226);
          --audio-bar-bg:#d3d0ca ;
          --audio-bar-played-bg: hsl(calc(var(--bg-hue) - 10), 30%, 40%);
          --audio-bar-buffered-bg: #8a710359;
          --audio-bar-loading-bg: rgba(255, 187, 0, 0.493);
          --audio-handle-bg: hsl(calc(var(--bg-hue) - 10), 30%, 40%);
          --spectrum-color: hsl(calc(var(--bg-hue) + 10), 15%, 30%);
          --active-color: #ffae00;
          --active-bg: #ffae00;
          --scrollbar-foreground: hsl(calc(var(--bg-hue)), 20%, 30%);
          --scrollbar-background: transparent;
        }
        
        html {
          font-size: 80.5%;
          user-select: none;
        }
        
        body {
          height: 100%;
          width: 100%;
          font-family: "Roboto", "Arial", sans-serif;
          
          background: url(https://www.toptal.com/designers/subtlepatterns/patterns/herringbone.png);
        }
        
        #ripple-effect-list,
        #ripple-effect-info {
          position: absolute;
          top: 2%;
          right: 4%;
          height: 4em;
          width: 4em;
          background: var(--bg-color);
          border-radius: 50%;
          transition: all 0.3s ease-in-out;
          z-index: 6;
          transition-delay: 0.2s;
          transform: scale(0);
        }
        
        #ripple-effect-info {
          left: 4%;
        }
        
        #player-wrapper {
          border-radius: 2rem;
          height: 100%;
          width: 100%;
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          
          background: var(--bg-color);
          overflow: hidden;
          z-index: 10;
        }
        
        #player-wrapper[data-show-list="true"] {
          #ripple-effect-list {
            transition-delay: 0s;
          }
          .playlist-container {
            pointer-events: initial;
            .list-container {
              opacity: 1;
              transition-delay: 0.35s;
            }
          }
        }
        
        #player-wrapper[data-show-info="true"] {
          #ripple-effect-info {
            transition-delay: 0s;
          }
          .info-container {
            pointer-events: initial;
            .info-wrapper {
              opacity: 1;
              transition-delay: 0.35s;
            }
          }
        }
        
        #player-wrapper .toolbar .list-icon,
        #player-wrapper .toolbar .info-icon {
          font-size: 1.3rem;
          display: flex;
          justify-content: flex-end;
          margin-bottom: 0.1em;
          position: absolute;
          top: 2%;
          right: 4%;
          color: var(--text-color);
          z-index: 8;
        }
        
        #player-wrapper .toolbar .list-icon i,
        #player-wrapper .toolbar .info-icon i {
          padding: 1.2rem;
          cursor: pointer;
          transition: background-color 0.3s;
          border-radius: 50%;
        }
        
        #player-wrapper .toolbar .list-icon i:hover,
        #player-wrapper .toolbar .info-icon i:hover {
          background-color: var(--hover-bg);
        }
        
        #player-wrapper .toolbar #close {
          font-size: 1.5rem;
          position: absolute;
          top: -2%;
          left: 50%;
          color: var(--text-color);
          z-index: 8;
          transform: translate(-50%, -100%);
          transition: all 0.3s;
        }
        
        #player-wrapper .toolbar #close.show {
          transform: translate(-50%, 0);
          top: 2%;
        }
        
        #player-wrapper .toolbar #close i {
          display: flex;
          height: 2.35em;
          width: 2.35em;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          border-radius: 50%;
          cursor: pointer;
          transition: background-color 0.3s;
        }
        
        #player-wrapper .toolbar #close i:hover {
          background-color: var(--hover-bg);
        }
        
        #player-wrapper .toolbar .info-icon {
          left: 4%;
          right: unset;
          font-size: 1.5rem;
        }
        
        #player-wrapper .info-container {
          height: inherit;
          width: inherit;
          border-radius: inherit;
          position: absolute;
          display: flex;
          flex-direction: column;
          color: var(--text-color);
          align-items: center;
          font-size: 1.1rem;
          padding: 5em 2.3em 2em;
          pointer-events: none;
          z-index: 6;
          left: 0;
          top: 0;
        }
        
        #player-wrapper .info-container .info-wrapper {
          opacity: 0;
          overflow: auto;
          transition: all 0.2s;
          padding: 0 2em 0 0;
          line-height: 1.7em;
        }
        
        #player-wrapper .info-container .info-wrapper p {
          margin: 0;
          margin-bottom: 1.4em;
        }
        
        #player-wrapper .playlist-container {
          height: inherit;
          width: inherit;
          border-radius: inherit;
          position: absolute;
          display: flex;
          flex-direction: column;
          color: var(--text-color);
          align-items: center;
          font-size: 2rem;
          padding: 3em 1em 1.5em;
          pointer-events: none;
          z-index: 6;
          left: 0;
          top: 0;
        }
        
        #player-wrapper .playlist-container .list-container {
          font-size: 1.3rem;
          overflow: auto;
          width: 100%;
          padding-right: 0.5em;
          transition-delay: 0;
          opacity: 0;
          transition: all 0.2s;
          background-color: #eed9ac;
        }
        
        #player-wrapper .playlist-container .list-container .list-item {
          display: flex;
          flex-direction: column;
          margin-bottom: 0.2em;
          cursor: pointer;
          transition: all 0.2s;
          padding: 0.8em 0.8em;
          border-radius: 0.3em;
          position: relative;
        }
        
        #player-wrapper .playlist-container .list-container .list-item:hover {
          background-color: var(--hover-bg);
        }
        
        #player-wrapper .playlist-container .list-container .list-item.active {
          background-color: var(--active-bg);
        }
        
        #player-wrapper .playlist-container .list-container .list-item.active .loading {
          animation: loading-list 3s linear infinite;
        }
        
        #player-wrapper .playlist-container .list-container .list-item .loading {
          position: absolute;
          top: 0;
          left: 0;
          height: 100%;
          width: 100%;
          background-image: repeating-linear-gradient(
            -70deg,
            var(--audio-bar-loading-bg) 0% 30%,
            rgba(243, 156, 18, 0) 30% 68%,
            var(--audio-bar-loading-bg) 68% 100%
          );
          background-size: 4em 4em;
          z-index: 0;
          animation: loading-list 3s linear infinite;
          pointer-events: none;
        }
        
        #player-wrapper .playlist-container .list-container .list-item > div {
          z-index: 1;
        }
        
        #player-wrapper .playlist-container .list-container .list-item .meta {
          display: flex;
          justify-content: space-between;
          font-size: 0.8em;
        }
        
        #player-wrapper .player-container {
          height: inherit;
          width: inherit;
          border-radius: inherit;
          display: flex;
          flex-direction: column;
          color: var(--text-color);
          align-items: center;
          font-size: 2rem;
          padding: 2.5em 0.5em 2em 0.5em;
        }
        
        #player-wrapper .player-container .title {
          font-size: 1em;
          font-weight: bold;
          white-space: nowrap;
          text-transform: capitalize;
        }
        
        #player-wrapper .player-container .author {
          font-size: 0.5em;
          text-align: center;
          text-transform: capitalize;
        }
        
        #player-wrapper .player-container .cover-wrapper {
          position: relative;
          height: 8em;
          width: 8em;
          margin: 1.5em 0;
        }
        
        #player-wrapper .player-container .cover-wrapper .prev-next {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border-radius: 50%;
          z-index: 5;
          display: flex;
          justify-content: space-around;
          align-items: center;
        }
        
        #player-wrapper .player-container .cover-wrapper .prev-next:hover {
          background-color: rgba(255, 255, 255, 0.1);
        }
        
   
        
        #player-wrapper .player-container .cover-wrapper .prev-next div {
          border-radius: 50%;
          height: 20%;
          width: 20%;
          background-color: transp;
          display: flex;
          justify-content: center;
          align-items: center;
          padding: 1em;
          color: var(--text-color);
          cursor: pointer;
          transition: all 0.2s;
          font-size: 1.5em;
        }
        
        #player-wrapper .player-container .cover-wrapper .prev-next div:hover {
          background-color: var(--hover-bg);
        }
        
        #player-wrapper .player-container .cover-wrapper .prev-next div.disabled {
          opacity: 0.2;
          cursor: default;
        }
        
        #player-wrapper .player-container .cover-wrapper #spectrum {
          height: 120%;
          width: 120%;
          border-radius: 50%;
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
        }
        
        #player-wrapper .player-container .cover-wrapper #spectrum polygon {
          stroke: var(--spectrum-color);
          stroke-width: 0.1em;
          fill: transparent;
        }
        
        #player-wrapper .player-container .cover-wrapper .cover {
          overflow: hidden;
          height: 100%;
          width: 100%;
          border-radius: 50%;
          flex-shrink: 0;
        }
        
        #player-wrapper .player-container .cover-wrapper .cover img {
          max-width: 100%;
          transition: all 0.2s;
        }
        
        #player-wrapper .player-container .chapter {
          margin-bottom: 2em;
          font-size: 0.7em;
        }
        
        #player-wrapper .player-container .audio-bar-wrapper {
          display: flex;
          flex-direction: column;
          width: 100%;
          margin-bottom: 1em;
        }
        
        #player-wrapper .player-container .audio-bar-wrapper .audio-bar-container {
          position: relative;
          padding: 0.3rem 0;
        }
        
        #player-wrapper .player-container .audio-bar-wrapper .audio-bar-container:hover .handle {
          transform: translate(-50%, -50%) scale(1);
        }
        
        #player-wrapper .player-container .audio-bar-wrapper .audio-bar-container .bar {
          width: 100%;
          height: 0.1em;
          background-color: var(--audio-bar-bg);
          border-radius: 0.3em;
          position: relative;
        }
        
        #player-wrapper .player-container .audio-bar-wrapper .audio-bar-container .bar .loading {
          position: absolute;
          top: 0;
          left: 0;
          height: 100%;
          width: 100%;
          background-image: repeating-linear-gradient(
            -55deg,
            var(--audio-bar-loading-bg) 0% 30%,
            rgba(243, 156, 18, 0) 30% 68%,
            var(--audio-bar-loading-bg) 68% 100%
          );
          background-size: 0.6em 0.4em;
          z-index: 5;
          animation: loading 1s linear infinite;
        }
        
        #player-wrapper .player-container .audio-bar-wrapper .audio-bar-container .bar .played {
          position: absolute;
          z-index: 3;
          background-color: var(--audio-bar-played-bg);
          height: 100%;
          left: 0;
        }
        
        #player-wrapper .player-container .audio-bar-wrapper .audio-bar-container .bar .buffered {
          background-color: var(--audio-bar-buffered-bg);
          display: inline-block;
          height: 100%;
          position: absolute;
          z-index: 2;
        }
        
        #player-wrapper .player-container .audio-bar-wrapper .audio-bar-container .handle {
          height: 0.6em;
          width: 0.6em;
          border-radius: 50%;
          cursor: pointer;
          background-color: var(--audio-handle-bg);
          position: absolute;
          transform: translate(-50%, -50%) scale(0);
          top: 50%;
          z-index: 4;
          transition: transform 0.3s;
        }
        
        #player-wrapper .player-container .time-container {
          display: flex;
          justify-content: space-between;
          font-size: 0.5em;
          margin-top: 0.7em;
        }
        
        #player-wrapper .player-container .options {
          display: flex;
          font-size: 0.5em;
          justify-content: space-between;
          width: 90%;
          align-items: center;
          margin-bottom: 1em;
        }
        
        #player-wrapper .player-container .options div {
          cursor: pointer;
          transition: all 0.2s;
          border-radius: 50%;
          height: 3em;
          width: 3em;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        
        #player-wrapper .player-container .options div.repeat i {
          font-size: 1.5em;
        }
        
        #player-wrapper .player-container .options div.speed {
          font-size: 1.1em;
        }
        
        #player-wrapper .player-container .options div.inactive {
          opacity: 0.3;
          cursor: default;
        }
        
        #player-wrapper .player-container .options div.active {
          color: var(--active-color);
        }
        
        #player-wrapper .player-container .options div:hover:not(.inactive) {
          background-color: var(--hover-bg);
        }
        
        #player-wrapper .player-container .controls {
          display: flex;
          font-size: 0.5em;
          justify-content: space-between;
          width: 90%;
          align-items: center;
        }
        
        #player-wrapper .player-container .controls .play-pause {
          font-size: 2em;
          height: 2em;
          width: 2em;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        
        #player-wrapper .player-container .controls div {
          cursor: pointer;
          transition: all 0.2s;
          border-radius: 50%;
          height: 3em;
          width: 3em;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        
        #player-wrapper .player-container .controls div.inactive {
          opacity: 0.3;
          cursor: default;
        }
        
        #player-wrapper .player-container .controls div:hover:not(.inactive) {
          background-color: var(--hover-bg);
        }
        
        #error-box {
          background-color: #f8d7da;
          padding: 1rem 2rem;
          border: 0.1rem solid #f5c6cb;
          position: absolute;
          bottom: 10%;
          width: 90%;
          left: 50%;
          border-radius: 0.4rem;
          transition: all 0.3s;
          transform: translate(-50%, 50%) scale(0);
          pointer-events: none;
          color: #721c24;
          font-weight: bold;
        }
        
        #error-box.show {
          transform: translate(-50%, 50%) scale(1);
        }
        #back-btn {
  position: fixed;
  top: 10px;
  left: 10px;
  font-size: 20px; /* Adjust the font size as needed */
  color: #333;
  cursor: pointer;
}
        </style>
    <div id='app'>
        <div id='player-wrapper' :data-show-list="(show_list) ? 'true' : 'false'" :data-show-info="(show_info) ? 'true' : 'false'">
            <div id='ripple-effect-list' :class="{active: show_list == true}"></div>
        
            <div class='toolbar'>
              <div id='ripple-effect-info' :class="{active: show_info == true}"></div>
              <div id='close' :class="{show: show_list == true || show_info == true}" @click='show_list = false; show_info = false'>
                <i class="fas fa-times"></i>
              </div>
              <div class='list-icon' @click='show_list = !show_list' v-if='show_list == false && show_info == false'>
                <i class="fas fa-stream"></i>
              </div>
              <div id="back-btn" onclick="goBack()" style="width: 20px; height: 20px;">
                  <i class="fa-solid fa-arrow-left" style="color: #000000;"></i>
              </div>
            </div>
            <div class='info-container'>
              <div class='info-wrapper' v-html='info'></div>
            </div>
      
          <div class='playlist-container'>
            <div class='list-container'>
              <div class='list-item' v-for='(c, i) in book.chapters' @click='audio_index = i' :class="{active: audio_index == i}">
                <div class='loading' v-if='is_loading == true'> </div>
                <div class="title">{{c.name}}</div>
                <div class='meta'>
                  <span class=''>{{c.reader}}</span>
                  <span class=''>{{c.duration}}</span>
                </div>
              </div>
            </div>
          </div>
          <div class='player-container'>
            <div class="title-container">
              <div class="title">{{book.title}}</div>
              <div class="author">{{book.author}}</div>
            </div>
            <div class="cover-wrapper">
              <div class='prev-next'>
                <div class='prev' :class="{disabled: audio_index <= 0}" @click='playPrev'>
                  <i class="fas fa-backward"></i>
                </div>
      
                <div class='next' :class="{disabled: audio_index >= book.chapters.length - 1}" @click='playNext'>
                  <i class="fas fa-forward"></i>
                </div>
              </div>
              <spectrum :pins='normlizeAudioPins' v-on:avarage="updateAvarage($event)"></spectrum>
              <div class='cover' :style='coverArtTransition'>
                <img src='../bookimages/elon musk.jpg'>
              </div>
            </div>
            <div class="chapter">{{book.chapters[audio_index].name}}</div>
            <div class="audio-bar-wrapper">
              <div class="audio-bar-container" @mousedown='barClick'>
                <div class="bar" ref='bar'>
                  <span class='loading' v-if='is_loading == true'></span>
                  <span class='played' :style="{width:handlePosition}"></span>
                  <span class='buffered' v-for='b in buffered' :style="{left: b.left, width: b.width}"></span>
                </div>
                <div class="handle" id='handle' :style="{left: handlePosition}"></div>
              </div>
              <div class="time-container">
                <div class="current">{{currentTime}}</div>
                <div class="end">{{endTime}}</div>
              </div>
            </div>
            <div class='options'>
              <div class='speed' @click="toggleSpeed"> {{speed}}x </div>
              <div class='repeat' @click="repeat = !repeat" :class="{active: repeat == true}">
                <i class='material-icons'>repeat</i>
              </div>
              <div class="auto-playlist" @click="list_play = !list_play" :class="{active: list_play == true}">
                <i class="material-icons">playlist_play</i>
              </div>
            </div>
            <div class='controls'>
              <div class="decrease-minute" @click="moveAudio('decrease', '60')" :class='{inactive: current_time < 60}'>-1m</div>
              <div class="decrease-seconds" @click="moveAudio('decrease', '30')" :class='{inactive: current_time < 30}'>-30s</div>
              <div class="play-pause" @click='playAudio()'>
                <i class="fas fa-play" v-if='is_playing == false'></i>
                <i class="fas fa-pause" v-if='is_playing == true'></i>
              </div>
              <div class="increase-seconds" @click="moveAudio('increase', '30')" :class='{inactive: leftTime < 30}'>+30s</div>
              <div class="increase-minute" @click="moveAudio('increase', '60')" :class='{inactive: leftTime < 60}'>+1m</div>
      
            </div>
          </div>
      
          <div id='error-box' :class="{show: is_error == true}">
            {{this.error_msg}}
          </div>
        </div>
      </div>
      
      <template id='spectrum-template'>
        <svg id='spectrum'>
          <polygon x="0" y="0" :points="points"></polygon>
        </svg>
      </template> 
      <script>
        const book = {
          title: "Elon musk Biography",
          author: "Fyodor DOSTOYEVSKY",
          cover_art:
            "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_1708.jpg",
          info: [
            'Crime and Punishment is the second of Fyodor Dostoyevsky\'s full-length novels following his return from 5 years of exile in Siberia, and is considered the first great novel of his "mature" period of writing.',
            "The novel focuses on the mental anguish and moral dilemmas of Rodion Raskolnikov, an impoverished ex-student in St. Petersburg who formulates and executes a plan to kill an unscrupulous pawnbroker for her cash.",
            "Raskolnikov, in an attempt to defend his actions, argues that with the pawnbroker's money he can perform good deeds to counterbalance the crime while ridding the world of a vermin, and to test a theory of his that some people are naturally superior and have the right to commit crimes if it is in pursuit of a higher purpose. ( Mark Nelson)"
          ],
          chapters: [
            {
              name: "Chapter 1 Elon musk",
              link:
                "Chapter 1 Elon Musk.mp3",
              reader: "Mark Nelson",
              duration: "00:05:38"
            },
            {
              name: "Chapter 2 AFRICA",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_01_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:21:23"
            },
            {
              name: "Chapter 3 CANADA",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_02_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:46:57"
            },
            {
              name: "Chapter 4 ELONâ€™S FIRST START-UP",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_03_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:33:07"
            },
            {
              name: "Chapter 5 PAYPAL MAFIA BOSS",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_04_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:32:15"
            },
            {
              name: "Chapter 6 MICE IN SPACE ",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_05_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:25:51"
            },
            {
              name: "Chapter 7 ALL ELECTRIC",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_06_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:31:09"
            },
            {
              name: "Chapter 8 PAIN, SUFFERING, AND SURVIVAL",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_07_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:29:42"
            },
            {
              name: "Chapter 9 LIFTOFF",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_08_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:43:11"
            },
            {
              name: "Chapter 10	THE REVENGE OF THE ELECTRIC CAR",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_09_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:26:38"
            },
            {
              name: "Chapter 11	THE UNIFIED FIELD THEORY OF ELON MUSK EPILOGUE",
              link:
                "https://ia800604.us.archive.org/20/items/crime_punishment_3_1708_librivox/crimepunishment_10_dostoyevsky_128kb.mp3",
              reader: "Mark Nelson",
              duration: "00:33:18"
            },
            
         
          ]
        };
        
        Vue.component("spectrum", {
          template: "#spectrum-template",
          props: ["pins"],
          data: function () {
            return {
              radius: 50,
              adjust: 0,
              avarage: 0,
              cover_art: null
            };
          },
          mounted: function () {
            const width = this.$el.getBoundingClientRect().width;
            const innerWidth = (width * 100) / 130;
            this.adjust = (width - innerWidth) / 2;
            this.radius = innerWidth / 2;
          },
          methods: {
            valueToPoint: function (value, index) {
              let angle = (360 * index) / this.total - 90;
        
              // convert to radians
              angle = (angle * Math.PI) / 180;
        
              var cos =
                Math.cos(angle) * (this.radius + value) + this.radius + this.adjust;
              var sin =
                Math.sin(angle) * (this.radius + value) + this.radius + this.adjust;
              return `${cos},${sin}`;
            }
          },
          computed: {
            points: function () {
              let avarage_count = 0;
              const retn = this.pins
                .map((p, index) => {
                  avarage_count += p;
                  return this.valueToPoint(p, index);
                })
                .join(" ");
              this.$emit("avarage", avarage_count / this.total);
        
              return retn;
            },
            total: function () {
              return this.pins.length;
            }
          }
        });
        
        new Vue({
          el: "#app",
          data: {
            handle_clicked: false,
            handle_position: 0,
            bar: null,
            is_playing: false,
            is_loading: true,
            is_error: false,
            error_timeout: null,
            error_msg: "",
            audio_obj: null,
            audio_index: 0,
            duration: 0,
            current_time: 0,
            audio_pins: [],
            analyser: null,
            data_array: [],
            buffered: [],
            speed: 1,
            repeat: false,
            repeat_count: 0,
            list_play: false,
            show_list: false,
            book: book,
            show_info: false,
            cover_art_avarage: 0
          },
          mounted: function () {
            this.bar = this.$refs.bar.getBoundingClientRect();
            let handle = this.$refs.handle;
        
            document.addEventListener("mousedown", this.mouseDown);
            document.addEventListener("mouseup", (e) => (this.handle_click = false));
            document.addEventListener("mousemove", this.moveHandler);
        
            window.addEventListener("resize", this.resizeHandler);
        
            // initiate audio obj
            this.audio_obj = new Audio(this.book.chapters[this.audio_index].link);
            this.audio_obj.crossOrigin = "anonymous";
            this.audio_obj.src = this.book.chapters[this.audio_index].link;
            this.audio_obj.load();
        
            this.audio_obj.addEventListener("loadeddata", () => {
              this.duration = this.audio_obj.duration;
            });
        
            this.audio_obj.addEventListener("ended", this.onEnded);
            this.audio_obj.addEventListener("progress", this.onProgress);
            this.audio_obj.addEventListener("loadedmetadata", this.onProgress);
            this.audio_obj.addEventListener("playing", (e) => (this.is_playing = true));
            this.audio_obj.addEventListener("pause", (e) => (this.is_playing = false));
            this.audio_obj.addEventListener(
              "canplay",
              (e) => (this.is_loading = false)
            );
            this.audio_obj.addEventListener("seeking", (e) => (this.is_loading = true));
            this.audio_obj.onerror = this.onError;
          },
          methods: {
            onError: function () {
              let msg = this.audio_obj.error.code + `: ` + this.audio_obj.error.message;
              console.error("ERROR", msg);
              this.is_error = true;
              this.error_msg = msg;
        
              this.is_playing = false;
              this.is_loading = false;
        
              clearTimeout(this.error_timeout);
              this.error_timeout = setTimeout(() => {
                this.is_error = false;
                this.error_msg = "";
              }, 3500);
            },
            onEnded: function (event) {
              this.audio_obj.currentTime = 0;
              if (this.repeat && this.repeat_count < 1) {
                this.audio_obj.play();
                this.repeat_count = this.repeat_count + 1;
                return;
              }
        
              if (this.repeat_count == 1) {
                this.repeat_count = 0;
              }
        
              if (this.list_play) {
                const newIndex = this.audio_index + 1;
                if (newIndex < this.book.chapters.length) this.audio_index = newIndex;
        
                return;
              }
        
              this.is_playing = false;
              this.repeat = false;
            },
            onProgress: function (e) {
              const oneSecond = 100 / this.duration;
              const ranges = [];
              for (var i = 0; i < this.audio_obj.buffered.length; i++) {
                const start = this.audio_obj.buffered.start(i);
                const end = this.audio_obj.buffered.end(i);
        
                const position = {};
                position.left = oneSecond * start + "%";
                position.width = oneSecond * (end - start) + "%";
        
                ranges.push(position);
              }
        
              this.buffered = ranges;
            },
            updateAvarage: function (event) {
              this.cover_art_avarage = event;
            },
            timeUpdated: function () {
              this.current_time = this.audio_obj.currentTime;
              this.analyser.getByteTimeDomainData(this.data_array);
              this.audio_pins = Array.from(this.data_array);
        
              requestAnimationFrame(this.timeUpdated);
            },
            playNext: function () {
              const newIndex = this.audio_index + 1;
        
              if (newIndex >= this.book.chapters.length) return;
        
              this.audio_index = newIndex;
            },
            playPrev: function () {
              const newIndex = this.audio_index - 1;
        
              if (newIndex < 0) return;
              this.audio_index = newIndex;
            },
            initAnalyser: function () {
              const ctx = new AudioContext();
              this.analyser = ctx.createAnalyser();
              const audioSrc = ctx.createMediaElementSource(this.audio_obj);
        
              // we could configure the analyser: e.g. analyser.fftSize (for further infos read the spec)
              // 256
              this.analyser.minDecibels = -90;
              this.analyser.maxDecibels = -10;
              this.analyser.smoothingTimeConstant = 0.75;
              this.analyser.fftSize = 128;
        
              // we have to connect the MediaElementSource with the analyser
              audioSrc.connect(this.analyser);
              this.analyser.connect(ctx.destination);
        
              const bufferLength = this.analyser.frequencyBinCount;
              this.data_array = new Uint8Array(bufferLength);
            },
            playAudio: function () {
              if (this.is_playing) this.audio_obj.pause();
              else this.audio_obj.play();
        
              if (this.analyser == null) {
                this.initAnalyser();
                requestAnimationFrame(this.timeUpdated);
              }
            },
            toggleSpeed: function () {
              const speedArray = [
                "0.5",
                "0.7",
                "1",
                "1.1",
                "1.2",
                "1.3",
                "1.4",
                "1.5",
                "1.6",
                "1.7",
                "1.8",
                "1.9",
                "2"
              ];
              const curerntIndex = speedArray.indexOf(this.speed.toString());
              let newIndex = curerntIndex + 1;
        
              if (newIndex > speedArray.length - 1) newIndex = 0;
        
              this.speed = parseFloat(speedArray[newIndex]);
              this.audio_obj.playbackRate = this.speed;
            },
            barClick: function (e) {
              const clickPos = e.clientX - this.bar.x;
              const time = (clickPos * this.duration) / this.bar.width;
              this.audio_obj.currentTime = time;
              this.handle_click = true;
            },
            mouseDown: function (e) {
              if (e.target.id == "handle") this.handle_click = true;
            },
            resizeHandler: function () {
              this.bar = this.$refs.bar.getBoundingClientRect();
            },
            formatSeconds: function (secs) {
              var hr = Math.floor(secs / 3600);
              var min = Math.floor((secs - hr * 3600) / 60);
              var sec = Math.floor(secs - hr * 3600 - min * 60);
        
              if (min < 10) {
                min = "0" + min;
              }
              if (sec < 10) {
                sec = "0" + sec;
              }
        
              return min + ":" + sec;
            },
            moveHandler: function (e) {
              let barWidth = this.bar.width;
              let barLeft = this.bar.x;
              let barRight = this.bar.right;
        
              if (this.handle_click) {
                let left = e.clientX - barLeft;
                if (left < 0) left = 0;
        
                if (left > barWidth) left = barWidth;
        
                this.current_time = (left * this.duration) / barWidth;
                this.audio_obj.currentTime = this.current_time;
              }
            },
            moveAudio: function (direction, amount) {
              let newTime = this.current_time;
              amount = parseInt(amount);
        
              switch (direction) {
                case "increase":
                  newTime = newTime + amount;
                  break;
                case "decrease":
                  newTime = newTime - amount;
                  break;
              }
        
              if (newTime > this.duration || newTime < 0) newTime = this.current_time;
        
              this.audio_obj.currentTime = newTime;
            },
            updateAudio: function (index) {}
          },
          computed: {
            endTime: function () {
              return this.formatSeconds(this.duration);
            },
            currentTime: function () {
              return this.formatSeconds(this.current_time);
            },
            handlePosition: function () {
              return (this.current_time * 100) / this.duration + "%";
            },
            leftTime: function () {
              return this.duration - this.current_time;
            },
            maxAudioPin: function () {
              return this.audio_pins
                .slice()
                .sort((a, b) => b - a)
                .slice(0, 1);
            },
            normlizeAudioPins: function () {
              // 20 is the max length
              return this.audio_pins.map((p) => {
                return (p * 20) / this.maxAudioPin;
              });
            },
            info: function () {
              return `<p>${this.book.info.join("</p><p>")}</p>`;
            },
            coverArtTransition: function () {
              let scale = (this.cover_art_avarage * 100) / 20 / 100;
              if (scale < 0.98) scale = 0.98;
        
              return {
                transform: `scale(${scale})`
              };
            },
            currentLink: function () {
              this.audio_obj.src = this.book.chapters[this.audio_index].link;
            }
          },
          watch: {
            audio_index: function (newIndex, oldVal) {
              this.audio_obj.src = this.book.chapters[newIndex].link;
              this.audio_obj.play();
              this.is_loading = true;
            }
          }
        });
        function goBack() {
            window.history.back();
        }
        </script>
</body>
</html>